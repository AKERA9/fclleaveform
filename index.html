<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leave Request Form</title>
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        'primary-red': '#D40000',
        'primary-dark-red': '#A30000',
        'success-green': '#10B981',
      }
    }
  }
}
</script>

<style>
.success-message { display:none }
</style>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div id="formBox" class="bg-white w-full max-w-md p-6 rounded-xl shadow-xl border-t-8 border-primary-red">
  <h2 class="text-2xl font-bold text-center mb-4">Leave Request</h2>

  <form id="leaveForm" class="space-y-4">

    <select name="name" required class="w-full p-3 border rounded">
      <option value="" disabled selected>-- Select Name --</option>
      <option>Aakash</option>
      <option>Rajmati</option>
      <option>Savya</option>
      <option>Deepak</option>
      <option>Rakesh</option>
      <option>Vedraaj</option>
    </select>

    <input type="date" name="date" id="date" required class="w-full p-3 border rounded">

    <select name="day" id="day" required class="w-full p-3 border rounded">
      <option disabled selected>-- Day --</option>
      <option>Monday</option>
      <option>Tuesday</option>
      <option>Wednesday</option>
      <option>Thursday</option>
      <option>Friday</option>
      <option>Saturday</option>
    </select>

    <textarea name="reason" required placeholder="Reason" class="w-full p-3 border rounded"></textarea>

    <div id="loadingParams" class="text-center text-gray-500 hidden">Saving to Sheet...</div>

    <button type="submit" id="submitBtn" class="w-full bg-primary-red text-white py-3 rounded font-bold hover:bg-primary-dark-red transition">
      Submit & Open WhatsApp
    </button>
  </form>
</div>

<div id="success" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
  <div class="bg-white p-6 rounded-xl text-center shadow-2xl max-w-sm mx-4">
    <div class="text-green-600 text-5xl mb-2">✔</div>
    <p class="font-bold text-lg mb-4 text-gray-800">Data Google Sheet me save ho gaya!</p>
    
    <a id="waBtn" target="_blank" class="block w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded mb-3 transition">
      Open WhatsApp Now
    </a>
    
    <button onclick="closePopup()" class="text-gray-500 hover:text-gray-800 underline">Close</button>
  </div>
</div>

<script>
// ⚠️ IMPORTANT: Niche apne naye deployment ka URL dalein (New Version wala)
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw2ZXcLdc5oYuSXkqtuTeW-KF8oaWJD9uiJgiSXxWyB3MVI-5EndEuVUF7oXwtn9W-F7g/exec";
const WA_NUMBER = "919711220917";

const form = document.getElementById("leaveForm");
const success = document.getElementById("success");
const waBtn = document.getElementById("waBtn");
const dayField = document.getElementById("day");
const dateField = document.getElementById("date");
const submitBtn = document.getElementById("submitBtn");
const loadingTxt = document.getElementById("loadingParams");

const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

// Set default date and day
dateField.value = new Date().toISOString().split("T")[0];
updateDay();

dateField.addEventListener("change", updateDay);

function updateDay(){
  const d = new Date(dateField.value).getDay();
  // Sunday ko chhodkar baki din update kare
  if(days[d] !== "Sunday") dayField.value = days[d];
}

form.addEventListener("submit", e => {
  e.preventDefault();

  // Button ko disable karein taki user bar-bar click na kare
  submitBtn.disabled = true;
  submitBtn.innerText = "Processing...";
  loadingTxt.classList.remove("hidden");

  const data = Object.fromEntries(new FormData(form).entries());

  // WhatsApp Message Format
  const text =
`*Leave Request*
Name: ${data.name}
Date: ${data.date}
Day: ${data.day}
Reason: ${data.reason}`;

  const waLink = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(text)}`;

  // Google Sheet me bhejna
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(data),
    // YAHAN FIX HAI: text/plain use kiya taki CORS error na aaye
    headers: { "Content-Type": "text/plain;charset=utf-8" }
  })
  .then(res => res.text()) // Text response handle karein
  .then((response) => {
    // Success hone par
    console.log("Success:", response);
    waBtn.href = waLink;
    
    // Popup dikhayein
    success.classList.remove("hidden");
    success.classList.add("flex");
    
    // Form reset karein aur button wapas thik karein
    form.reset();
    dateField.value = new Date().toISOString().split("T")[0];
    updateDay();
    submitBtn.disabled = false;
    submitBtn.innerText = "Submit & Open WhatsApp";
    loadingTxt.classList.add("hidden");
    
    // Auto open WhatsApp logic (Optional: Popup ke button se hi behtar rehta hai)
    window.open(waLink, "_blank");
  })
  .catch((error) => {
    console.error("Error:", error);
    alert("Sheet me data save nahi hua, lekin WhatsApp khul raha hai.");
    window.open(waLink, "_blank");
    
    submitBtn.disabled = false;
    submitBtn.innerText = "Submit & Open WhatsApp";
    loadingTxt.classList.add("hidden");
  });
});

function closePopup(){
  success.classList.add("hidden");
  success.classList.remove("flex");
}
</script>

</body>
</html>




